# This thing handles the main quest line, at least for now
# @author Wahrheit
# @version 3.0
# @last-updated April 26 2019

"New Quest Master":
    type: assignment
    interact scripts:
    - 10 Newbie
    actions:
        on assignment:
        - teleport npc 'location:<anchor:questmaster>'
        - trigger name:proximity toggle:true        
    
"Quest Master Format":
    type: format
    format: "<dark_green>Quest Master<white><&co> <text>"

FoundSomeDiamonds:
    type: task
    script:
    - narrate "<dark_green>Quest Master<white><&co> Not quite all the Treasure Hunters, but here's what you've earned!"
    - give diamond "qty:<player.flag[npccount]>"
    - give emerald "qty:<player.flag[npccount]>"
    - flag player npccount:0
FoundAllDiamonds:
    type: task
    script:
    - narrate "<dark_green>Quest Master<white><&co> Oh, I see you found all the Treasure Hunters! Here are your rewards!"
    - give diamond qty:8
    - give emerald qty:8
    - give diamond_helmet qty:1
    - give diamond_chestplate qty:1
    - give diamond_leggings qty:1
    - give diamond_boots qty:1
    - flag npccount:0
"Fishing Done":
    type: task
    script:
    - zap "script:Newbie" "step:Find Youngling Trainers"
"Youngling Trainers Found":
    type: task
    script:
    - zap "script:Newbie" "step:Talk to Postmaster"
"Postmaster Spoken To":
    type: task
    script:
    - zap "script:Newbie" "step:Waiting for Quest"
QuestProgressHandler:
    type: world
    events:
        on player joins:
        - if "<player.quests.completed_names.contains[Deliver the Swabby's package to the Quest Master]>":
            - zap Swabby-Completed s@Newbie
"Newbie":
    type: interact
    steps:
        'Greeting*':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Welcome to the Questing Hall, <player.name>! The folks here have a variety of quests that you can complete to help out our citizens."
                    - wait 0.7s
                    - narrate "format:Quest Master Format" "I've got a series of quests, too, that will help ease you into your adventure. I'll even toss you a little coin for your efforts, as well as a few other surprise bonuses."
                    - if <player.flag[npccount]||0>  == 8:
                        - run FoundAllDiamonds instantly
                    - if <player.flag[npccount]||0> < 8 && <player.flag[npccount]||0> > 0:
                        - run FoundSomeDiamonds instantly
                    - zap WoodTools-Prompt
        Swabby-Completed:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Thanks for delivering that package from Swabby, <player.name>!"
                    - wait 0.7s
                    - narrate "format:Quest Master Format" "Say, I think you're ready for something more exciting. How about it?"
                    - zap WoodTools-Prompt
        WoodTools-Prompt:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "I've got your first real get-out-in-the-world quest for you as soon as you're ready."
        WoodTools-Taken:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Hey there <player.name>, still waiting on those tools."
        Breaking-ground-Prompt:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Ready to put those wood tools to use? I've got another quest for you! You'll get a reward for doing just that. Quick and easy."
        Breaking-ground-Taken:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Hey <player.name>, you putting those tools to work yet?"
        Mooving-on-up-Prompt:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Nice job on that last quest. Now you've got some basic tools, but you're still missing an adventurer's essential. Talk to me for the next quest when you're ready."
        Mooving-on-up-Taken:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Nice job on that last quest. Now you've got some basic tools, but you're still missing an adventurer's essential. Talk to me for the next quest when you're ready."
        Find-Warmaster-Reinwald-Prompt:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "I'm not the only one with quests for you, <player.name>. I've got two quests for you now - one to go meet a friend, and one to upgrade your armaments."
        Reinwald-Found-Iron-Price-Prompt:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Hey, you found Reinwald! He and his troops are a good source of quests. Keep them in mind."
                    - wait 0.7s
                    - narrate "format:Quest Master Format" "You ready for that next upgrade quest? I sure am."
        Iron-Price-Paid-Find-Reinwald:
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "You're making me proud with how fast you're upgrading your equipment and building your story. Before you get more quests from me, though, you should go meet a friend of mine."
        'Fishing':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Hey <player.name>! I can still help you get some equipment, right click me to see the quest details."
                    - narrate "format:Quest Master Format" "If you want to quit the one you're on at any time, you can type /quests quit."
        'FindYounglingTrainers':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Hey there, <player.name>. There are some people I'd like you to meet, if you have time."
        'TalkToPostmaster':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "Howdy <player.name>! Want another quick task?"
        'WaitingForQuest':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "I don't have any quests for you right now <player.name>, but have a look around! There are plenty of others."
        ## When the next quest is ready to go, uncomment the following line and change the zap to the new step.
                    # - narrate "format:Quest Master Format" "Hey, I have a new quest for you!"
                    # - zap 'step:New Quest'
        'NoQuests':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "I don't have any quests for you right now <player.name>, but have a look around! There are plenty of others."
#                    - zap 'step:Next Quest'
        'NextQuest':
            proximity trigger:
                entry:
                    script:
                    - narrate "format:Quest Master Format" "I don't have any quests for you right now <player.name>, but have a look around! There are plenty of others."
                    - zap 'step:No Quests'